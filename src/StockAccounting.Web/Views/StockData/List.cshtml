@using System.Globalization
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using StockAccounting.Core.Data.Enums
@using StockAccounting.Web.Extensions
@model StockDataViewModel
@{
    ViewData["Title"] = "StockData";
}

<div class="container">
    <alerts></alerts>
    <div class="row pb-3">
        <div class="col-xs-12">
            <div class="dropdown show">
                <a aria-pressed="true" class="dropdown-toggle"
                   role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="green" class="bi bi-file-earmark-excel" viewBox="0 0 16 16">
                    <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z" />
                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z" />
                    </svg>
                </a>

                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                    <a class="dropdown-item stockExcel" href="#" value="@FileExport.Taken">Parts taken by the stock</a>
                    <a class="dropdown-item stockExcel" href="#" value="@FileExport.Returned">Parts returned by the stock</a>
                    <a class="dropdown-item stockExcel" href="#" value="@FileExport.Default">Parts currently remaining with the stock</a>
                </div>
            </div>
        </div>
        <div class="col"></div>
        <div class="col">
            <div class="input-group">
                <input type="text" name="searchStockData" id="searchStockDataId" value="@Model.SearchText" class="form-control" placeholder="Search...">
                <button type="button" class="btn bg-transparent" style="margin-left: -40px; z-index: 100;" id="btnStockDataClearSearch">
                    <i class="fa fa-times"></i>
                </button>
                <a id="btnSearchStockData" class="btn btn-primary search-link" asp-controller="stockData" asp-action="List" asp-route-id="1" asp-route-searchText="dummyText">Search</a>
            </div>
        </div>
    </div>

    <div class="fixed-table-container" id="divTable" style="display: none;">
        <table class="table" id="stockTable">
            <thead>
            <tr>
                <th><input name="checkbox" type="checkbox" id="checkBoxAll" class="custom-checkbox"/></th>
                <th>Name</th>
                <th>ItemNumber</th>
                <th>Barcode</th>
                <th>PluCode</th>
                <th>Quantity</th>
                <th>Unit</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            @{
                System.Diagnostics.Debug.Assert(Model != null, nameof(Model) + " != null");
                System.Diagnostics.Debug.Assert(Model.StockDataModel != null, "Model.StockModel != null");
            }

            @foreach (var item in Model.StockDataModel)
            {
                <tr id="data_@item.Id">
                    <td>
                        <input type="checkbox" value="@item.Id" class="custom-checkbox chkCheckBoxId" id="checkBox"/>
                    </td>
                    <td>@item.Name</td>
                    <td>@item.ItemNumber</td>
                    <td>@item.Barcode</td>
                    <td>@item.PluCode</td>
                    <td>
                        <a onclick="location.href = '@Url.Action("LeftQuantity", "StockData", new { stockDataId = item.Id })'"
                           style="cursor: pointer;" id="quantity">
                           @String.Format(CultureInfo.InvariantCulture, "{0:0.00}", item.LeftQuantity)
                        </a>
                    </td>
                    <td>@item.Unit</td>
                    <td align="right">
                        <a class="btn btn-outline-primary" 
                           role="button" 
                           aria-pressed="true" 
                           asp-controller="StockData" 
                           asp-action="Details" 
                           asp-route-id="@item.Id">Details</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
    <div class="row justify-content-end pr-3">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                @if (Model.EndPage > 9)
                {
                    <li class="page-item"><a class="page-link search-link" asp-controller="StockData" asp-action="List" asp-route-pageId="1" asp-route-searchText="dummyText">1</a></li>
                    <li class="page-item disabled"><a class="page-link">...</a></li>
                }
                @for (var i = Model.StartPage; i <= Model.EndPage; i++)
                {
                    var activePage = (Model.PageIndex == i) ? "active" : "";
                    <li class="page-item @activePage"><a class="page-link search-link" asp-controller="StockData" asp-action="List" asp-route-pageId="@i" asp-route-searchText="dummyText">@i</a></li>

                }
                @if (Model.EndPage >= 9 && Model.EndPage < Model.TotalPages)
                {
                    <li class="page-item disabled"><a class="page-link">...</a></li>
                    <li class="page-item"><a class="page-link search-link" asp-controller="StockData" asp-action="List" asp-route-pageId="@Model.TotalPages" asp-route-searchText="dummyText">@Model.TotalPages</a></li>
                }
            </ul>
        </nav>
    </div>
</div>

@section Scripts{
    <script src="~/js/stockData.js" asp-append-version="true"></script>
}